apiVersion: emr.aws.upbound.io/v1alpha1
kind: Cluster
metadata:
  name: example
spec:
  forProvider:
    additionalInfo: |
      {
        "instanceAwsClientConfiguration": {
          "proxyPort": 8099,
          "proxyHost": "myproxy.example.com"
        }
      }
    applications:
    - Spark
    bootstrapAction:
    - args:
      - instance.isMaster=true
      - echo running on master node
      name: runif
      path: s3://elasticmapreduce/bootstrap-actions/run-if
    configurationsJson: |2
        [
          {
            "Classification": "hadoop-env",
            "Configurations": [
              {
                "Classification": "export",
                "Properties": {
                  "JAVA_HOME": "/usr/lib/jvm/java-1.8.0"
                }
              }
            ],
            "Properties": {}
          },
          {
            "Classification": "spark-env",
            "Configurations": [
              {
                "Classification": "export",
                "Properties": {
                  "JAVA_HOME": "/usr/lib/jvm/java-1.8.0"
                }
              }
            ],
            "Properties": {}
          }
        ]
    coreInstanceGroup:
    - autoscalingPolicy: |
        {
        "Constraints": {
          "MinCapacity": 1,
          "MaxCapacity": 2
        },
        "Rules": [
          {
            "Name": "ScaleOutMemoryPercentage",
            "Description": "Scale out if YARNMemoryAvailablePercentage is less than 15",
            "Action": {
              "SimpleScalingPolicyConfiguration": {
                "AdjustmentType": "CHANGE_IN_CAPACITY",
                "ScalingAdjustment": 1,
                "CoolDown": 300
              }
            },
            "Trigger": {
              "CloudWatchAlarmDefinition": {
                "ComparisonOperator": "LESS_THAN",
                "EvaluationPeriods": 1,
                "MetricName": "YARNMemoryAvailablePercentage",
                "Namespace": "AWS/ElasticMapReduce",
                "Period": 300,
                "Statistic": "AVERAGE",
                "Threshold": 15.0,
                "Unit": "PERCENT"
              }
            }
          }
        ]
        }
      bidPrice: "0.30"
      ebsConfig:
      - size: "40"
        type: gp2
        volumesPerInstance: 1
      instanceCount: 1
      instanceType: c4.large
    ebsRootVolumeSize: 100
    ec2Attributes:
    - emrManagedMasterSecurityGroup: ${aws_security_group.sg.id}
      emrManagedSlaveSecurityGroup: ${aws_security_group.sg.id}
      instanceProfile: ${aws_iam_instance_profile.emr_profile.arn}
      subnetId: ${aws_subnet.main.id}
    keepJobFlowAliveWhenNoSteps: true
    masterInstanceGroup:
    - instanceType: m4.large
    name: emr-test-arn
    releaseLabel: emr-4.6.0
    serviceRole: ${aws_iam_role.iam_emr_service_role.arn}
    tags:
      env: env
      role: rolename
    terminationProtection: false
  providerConfigRef:
    name: example
