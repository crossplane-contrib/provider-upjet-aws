# Example of namespace-scoped ProviderConfig using IRSA with per-namespace ServiceAccount
# This enables multi-tenant security isolation by using namespace-specific IAM roles
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: team-a
  namespace: team-a
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/team-a-irsa-role
---
apiVersion: aws.m.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: team-a-irsa
  namespace: team-a
spec:
  credentials:
    source: ServiceAccount
  # Reference to the ServiceAccount in the same namespace
  # The namespace is automatically inherited from metadata.namespace
  serviceAccountRef:
    name: team-a
  # At least one role must be specified for AssumeRoleWithWebIdentity
  assumeRoleChain:
    - roleARN: arn:aws:iam::123456789012:role/team-a-irsa-role
