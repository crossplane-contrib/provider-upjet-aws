# Example showing ServiceAccount-based Auth with role chaining
# Demonstrates assuming multiple roles in sequence for cross-account access
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cross-account-sa
  namespace: dev-team
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::111111111111:role/dev-base-role
---
apiVersion: aws.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: cross-account-irsa
spec:
  credentials:
    source: ServiceAccount
  serviceAccountRef:
    name: cross-account-sa
    namespace: dev-team
  # First role is assumed with AssumeRoleWithWebIdentity using the ServiceAccount token
  # Additional roles are assumed using AssumeRole in sequence
  assumeRoleChain:
    - roleARN: arn:aws:iam::111111111111:role/dev-base-role
      externalID: "dev-team-external-id"
    - roleARN: arn:aws:iam::222222222222:role/prod-cross-account-role
      tags:
        - key: Environment
          value: Production
        - key: Team
          value: DevTeam
